<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IMEI Generator with TAC Lookup</title>
  <style>
    :root {
      --primary: #3498db;
      --primary-dark: #2980b9;
      --secondary: #2ecc71;
      --secondary-dark: #27ae60;
      --accent: #9b59b6;
      --accent-dark: #8e44ad;
      --text: #333;
      --light-text: #666;
    }
    * { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    html, body {
      background-color: #ffffff !important;
      color: var(--text);
      padding: 20px;
      line-height: 1.6;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 30px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: var(--primary-dark);
    }
    .input-form {
      display: grid;
      gap: 20px;
    }
    .form-group { display: flex; flex-direction: column; }
    label { font-weight: 600; margin-bottom: 5px; }
    input, textarea, select {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
    }
    .input-hint { font-size: 0.9rem; color: var(--light-text); }
    .error { color: #e74c3c; font-size: 0.9rem; }
    .hidden { display: none; }
    .button-group { display: flex; gap: 10px; }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
      cursor: pointer;
      background-color: var(--primary);
      color: white;
    }
    button.secondary-button { background-color: var(--secondary); }
    .results-container { margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 8px 12px; border: 1px solid #ddd; text-align: left; }
    th { background-color: var(--primary); color: white; }
    #tacCount { font-weight: 600; }
  </style>
</head>
<body>
  <div class="container">
    <h1>IMEI Generator with TAC Lookup</h1>
    <p>Enter IMEI details and download a CSV of generated IMEIs with Make &amp; Model lookups.</p>
    <div class="input-form">
      <div class="form-group">
        <label for="startingImei">Starting IMEI Number</label>
        <input id="startingImei" type="text" placeholder="Enter a 15-digit IMEI" maxlength="15" pattern="[0-9]{15}">
        <p id="imeiError" class="error hidden">Please enter a valid 15-digit IMEI number</p>
      </div>
      <div class="form-group">
        <label for="quantity">Quantity</label>
        <input id="quantity" type="number" min="1" max="10000" placeholder="How many IMEIs to generate?">
        <p id="quantityError" class="error hidden">Enter a quantity between 1 and 10000</p>
      </div>
      <div class="button-group">
        <button id="generateBtn">Generate IMEIs</button>
        <button id="downloadBtn" class="secondary-button">Download CSV</button>
      </div>
      <div class="form-group">
        <p>TAC entries loaded in background: <span id="tacCount">0</span></p>
      </div>
    </div>
    <div id="resultsContainer" class="results-container hidden">
      <div><strong>Total generated:</strong> <span id="resultCount">0</span></div>
      <div class="results-table-wrapper">
        <table>
          <thead>
            <tr>
              <th>IMEI</th>
              <th>TAC</th>
              <th>Serial</th>
              <th>Brand</th>
              <th>Model</th>
            </tr>
          </thead>
          <tbody id="resultsTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    let tacDatabase = {};

    // DOM elements
    const startingImeiInput = document.getElementById('startingImei');
    const quantityInput = document.getElementById('quantity');
    const generateBtn = document.getElementById('generateBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const resultsContainer = document.getElementById('resultsContainer');
    const resultsTableBody = document.getElementById('resultsTableBody');
    const resultCount = document.getElementById('resultCount');
    const imeiError = document.getElementById('imeiError');
    const quantityError = document.getElementById('quantityError');

    // Store generated IMEIs for download
    let generatedImeis = [];

    function validateImei() {
      const val = startingImeiInput.value.trim();
      const isValid = /^[0-9]{15}$/.test(val);
      imeiError.classList.toggle('hidden', isValid);
      return isValid;
    }

    function validateQuantity() {
      const val = parseInt(quantityInput.value, 10);
      const isValid = val >= 1 && val <= 10000;
      quantityError.classList.toggle('hidden', isValid);
      return isValid;
    }

    function generateImeis() {
      if (!validateImei() || !validateQuantity()) return;

      const base = startingImeiInput.value.trim().slice(0, 8);
      const count = parseInt(quantityInput.value, 10);
      generatedImeis = [];
      resultsTableBody.innerHTML = '';

      for (let i = 0; i < count; i++) {
        const serial = String(i + 1).padStart(6, '0');
        const partial = base + serial;
        const check = partial.split('').reduce((sum, d, idx) => {
          let val = parseInt(d, 10);
          if (idx % 2 === 1) {
            val *= 2;
            if (val > 9) val -= 9;
          }
          return sum + val;
        }, 0);
        const checkDigit = (10 - (check % 10)) % 10;
        const fullImei = partial + checkDigit;
        const tac = fullImei.slice(0, 8);
        const lookup = tacDatabase[tac] || {};
        const brand = lookup.brand || 'Unknown';
        const model = lookup.model || 'Unknown';

        generatedImeis.push({ imei: fullImei, tac, serial, brand, model });
        const row = `<tr>
          <td>${fullImei}</td><td>${tac}</td><td>${serial}</td>
          <td>${brand}</td><td>${model}</td>
        </tr>`;
        resultsTableBody.insertAdjacentHTML('beforeend', row);
      }

      resultCount.textContent = generatedImeis.length;
      resultsContainer.classList.remove('hidden');
    }

    function downloadCsv() {
      if (!generatedImeis.length) return;
      const header = ['IMEI','TAC','Serial','Brand','Model'];
      const rows = generatedImeis.map(r => [r.imei, r.tac, r.serial, r.brand, r.model]);
      const csvContent = 'data:text/csv;charset=utf-8,'
        + [header, ...rows].map(r => r.join(',')).join('\n');
      const link = document.createElement('a');
      link.setAttribute('href', encodeURI(csvContent));
      link.setAttribute('download', 'generated_imeis.csv');
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function init() {
      // Load TAC database from JSON
      fetch('tac-database.json')
        .then(res => res.json())
        .then(data => {
          tacDatabase = data;
          document.getElementById('tacCount').textContent = Object.keys(data).length;
        })
        .catch(err => console.error('Failed to load TAC data:', err));

      // Set up event handlers
      generateBtn.addEventListener('click', generateImeis);
      downloadBtn.addEventListener('click', downloadCsv);
      startingImeiInput.addEventListener('blur', validateImei);
      quantityInput.addEventListener('blur', validateQuantity);
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
